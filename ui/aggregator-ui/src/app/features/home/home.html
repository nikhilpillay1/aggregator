<div class="card mt-8">
  <div class="flex gap-3 align-items-end mb-3">

<!--    <div *ngIf="uploading"-->
<!--         style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;-->
<!--              background: rgba(255,255,255,0.8); z-index: 1000;-->
<!--              display: flex; align-items: center; justify-content: center;">-->
<!--      <div class="flex flex-column align-items-center gap-3">-->
<!--        <i class="pi pi-spin pi-spinner" style="font-size: 3rem;"></i>-->
<!--        <span class="font-semibold">Uploading and processing file...</span>-->
<!--      </div>-->
<!--    </div>-->

    <div class="flex-1">
      <label for="source" class="block mb-2">Source</label>
      <p-select
        id="source"
        [(ngModel)]="selectedSource"
        [options]="sources"
        placeholder="Please select a source before uploading"
        [style]="{'width': '100%'}" />
    </div>

    <div class="flex-1">
      <label class="block mb-2">CSV File</label>
      <p-fileUpload
        name="file"
        [customUpload]="true"
        (uploadHandler)="onUpload($event)"
        accept=".csv"
        [maxFileSize]="5000000"
        [disabled]="!selectedSource"
        [auto]="false"
        chooseLabel="Choose CSV"
        uploadLabel="Upload"
        cancelLabel="Clear">
        <ng-template pTemplate="content" let-files>
          <div *ngIf="files.length > 0">
            <div *ngFor="let file of files" class="flex align-items-center gap-3 p-3">
              <i class="pi pi-file text-4xl mt-1"></i>
              <div class="flex-1">
                <div class="font-semibold">{{ file.name }}</div>
              </div>
            </div>
          </div>
        </ng-template>
      </p-fileUpload>
    </div>
  </div>
</div>

<div class="card">
  <div class="flex flex-wrap gap-3 mt-4 mb-4">
    <input
      pInputText
      [(ngModel)]="searchText"
      (ngModelChange)="onSearch()"
      placeholder="Search description..."
      class="flex-1"/>

    <p-select
      [(ngModel)]="selectedCategory"
      [options]="categories"
      (onChange)="onSearch()"
      placeholder="Category"
      [showClear]="true"/>

    <p-datePicker
      [(ngModel)]="dateFrom"
      (onSelect)="onSearch()"
      placeholder="From Date"
      [showClear]="true"/>

    <p-datePicker
      [(ngModel)]="dateTo"
      (onSelect)="onSearch()"
      placeholder="To Date"
      [showClear]="true"/>

    <input
      pInputText
      type="number"
      [(ngModel)]="minAmount"
      (ngModelChange)="onSearch()"
      placeholder="Min Amount"/>

    <input
      pInputText
      type="number"
      [(ngModel)]="maxAmount"
      (ngModelChange)="onSearch()"
      placeholder="Max Amount"/>
  </div>

  <p-table
    [value]="transactions"
    [loading]="uploading"
    [paginator]="true"
    [rows]="8"
    [totalRecords]="totalRecords"
    [lazy]="true"
    [customSort]="true"
    (onLazyLoad)="loadTransactions($event)"
    sortMode="single">

    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="date">
          Date <p-sortIcon field="date" />
        </th>
        <th pSortableColumn="description">
          Description <p-sortIcon field="description" />
        </th>
        <th pSortableColumn="amount">
          Amount <p-sortIcon field="amount" />
        </th>
        <th pSortableColumn="category">
          Category <p-sortIcon field="category" />
        </th>
        <th style="width: 80px">Delete</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-transaction>
      <tr>
        <td>{{ transaction.date }}</td>
        <td>{{ transaction.description }}</td>
        <td>{{ transaction.amount | currency:'R ' }}</td>
        <td>{{ transaction.category }}</td>
        <td>
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-rounded p-button-danger p-button-text"
            (click)="deleteTransaction(transaction.id)">
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
